<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-99.9.9">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Masatoshi Katabuchi">
<meta name="dcterms.date" content="2023-11-16">

<title>Diversity calculation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="diversity_example_files/libs/clipboard/clipboard.min.js"></script>
<script src="diversity_example_files/libs/quarto-html/quarto.js"></script>
<script src="diversity_example_files/libs/quarto-html/popper.min.js"></script>
<script src="diversity_example_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="diversity_example_files/libs/quarto-html/anchor.min.js"></script>
<link href="diversity_example_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="diversity_example_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="diversity_example_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="diversity_example_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="diversity_example_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<style>html{ scroll-behavior: smooth; }</style>
<link href="diversity_example_files/libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="diversity_example_files/libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="diversity_example_files/libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="diversity_example_files/libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="diversity_example_files/libs/datatables-binding-0.30/datatables.js"></script>
<script src="diversity_example_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="diversity_example_files/libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="diversity_example_files/libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="diversity_example_files/libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script>
<link href="diversity_example_files/libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="diversity_example_files/libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#objectives" id="toc-objectives" class="nav-link active" data-scroll-target="#objectives"><span class="header-section-number">1</span> Objectives</a></li>
  <li><a href="#prerequisites" id="toc-prerequisites" class="nav-link" data-scroll-target="#prerequisites"><span class="header-section-number">2</span> Prerequisites</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data"><span class="header-section-number">3</span> Data</a>
  <ul class="collapse">
  <li><a href="#community" id="toc-community" class="nav-link" data-scroll-target="#community"><span class="header-section-number">3.1</span> Community</a></li>
  <li><a href="#phylogeny" id="toc-phylogeny" class="nav-link" data-scroll-target="#phylogeny"><span class="header-section-number">3.2</span> Phylogeny</a></li>
  <li><a href="#traits" id="toc-traits" class="nav-link" data-scroll-target="#traits"><span class="header-section-number">3.3</span> Traits</a></li>
  <li><a href="#check-how-traits-look-like-first" id="toc-check-how-traits-look-like-first" class="nav-link" data-scroll-target="#check-how-traits-look-like-first"><span class="header-section-number">3.4</span> Check how traits look like first</a></li>
  </ul></li>
  <li><a href="#first-order-metrics-without-phylogeny-or-traits" id="toc-first-order-metrics-without-phylogeny-or-traits" class="nav-link" data-scroll-target="#first-order-metrics-without-phylogeny-or-traits"><span class="header-section-number">4</span> First-order metrics (without phylogeny or traits)</a>
  <ul class="collapse">
  <li><a href="#species-richness" id="toc-species-richness" class="nav-link" data-scroll-target="#species-richness"><span class="header-section-number">4.1</span> Species richness</a></li>
  <li><a href="#shannon" id="toc-shannon" class="nav-link" data-scroll-target="#shannon"><span class="header-section-number">4.2</span> Shannon</a></li>
  <li><a href="#nonmetric-multidimensional-scaling-nmds" id="toc-nonmetric-multidimensional-scaling-nmds" class="nav-link" data-scroll-target="#nonmetric-multidimensional-scaling-nmds"><span class="header-section-number">4.3</span> Nonmetric Multidimensional Scaling (NMDS)</a></li>
  </ul></li>
  <li><a href="#phylogenetic-metrics" id="toc-phylogenetic-metrics" class="nav-link" data-scroll-target="#phylogenetic-metrics"><span class="header-section-number">5</span> Phylogenetic metrics</a>
  <ul class="collapse">
  <li><a href="#branch-length-based-metric" id="toc-branch-length-based-metric" class="nav-link" data-scroll-target="#branch-length-based-metric"><span class="header-section-number">5.1</span> Branch length based metric</a></li>
  <li><a href="#distance-based-metric" id="toc-distance-based-metric" class="nav-link" data-scroll-target="#distance-based-metric"><span class="header-section-number">5.2</span> Distance based metric</a></li>
  </ul></li>
  <li><a href="#functional-metrics" id="toc-functional-metrics" class="nav-link" data-scroll-target="#functional-metrics"><span class="header-section-number">6</span> Functional metrics</a>
  <ul class="collapse">
  <li><a href="#community-weighted-means-cwm" id="toc-community-weighted-means-cwm" class="nav-link" data-scroll-target="#community-weighted-means-cwm"><span class="header-section-number">6.1</span> Community weighted means (CWM)</a></li>
  <li><a href="#distance-based-metrics" id="toc-distance-based-metrics" class="nav-link" data-scroll-target="#distance-based-metrics"><span class="header-section-number">6.2</span> Distance based metrics</a></li>
  <li><a href="#branch-length-based-metric-1" id="toc-branch-length-based-metric-1" class="nav-link" data-scroll-target="#branch-length-based-metric-1"><span class="header-section-number">6.3</span> Branch length based metric</a></li>
  </ul></li>
  <li><a href="#related" id="toc-related" class="nav-link" data-scroll-target="#related"><span class="header-section-number">7</span> Related</a></li>
  <li><a href="#computing-environment" id="toc-computing-environment" class="nav-link" data-scroll-target="#computing-environment"><span class="header-section-number">8</span> Computing Environment</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Diversity calculation</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Masatoshi Katabuchi </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 16, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<p><a href="https://twitter.com/mattocci"><i class="fa fa-twitter fa-1x"></i> Twitter</a> <a href="https://github.com/mattocci27/"><i class="fa fa-github fa-1x"></i> Github</a> <a href="mailto:mattocci27@gmail.com"><i class="fa fa-envelope fa-1x"></i> Email</a></p>
<p>Course materials for 2023-11-16 AFEC at XTBG.</p>
<section id="objectives" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Objectives</h1>
<ul>
<li>Prepare species <span class="math inline">\(\times\)</span> site matrices and trait data from csv files.</li>
<li>Calculate diversity indices.</li>
</ul>
</section>
<section id="prerequisites" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Prerequisites</h1>
<p>Clone this repo.</p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-1_08cf514b8fc540d2937ab0c3d27acd84">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/mattocci27/phy-fun-div.git</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cloning into 'phy-fun-div'...</code></pre>
</div>
</div>
<pre><code>tree</code></pre>
<p>The following command (probably) installs all the R packages required for this course.</p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-2_d31942b993e8bf82ef4d95354809636b">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">restore</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Otherwise, please install those packages manually without using <code>renv</code> (I might miss some packages).</p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-3_e6c87d02e7352d3daa55d70202652562">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"picante"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"FD"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"rmarkdown"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"DT"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"quarto"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Load some packages.</p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-4_9cd077b54017ab59ac62ff362a6e7853">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(picante)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Data</h1>
<section id="community" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="community"><span class="header-section-number">3.1</span> Community</h2>
<p>First, we import the community data.</p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-5_1eda54407eef55e1e9c621dfa6b1927d">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/samp.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>I prefer <code>read_csv</code> but <code>read.csv</code> is fine too.</li>
<li>Our working directory is <code>phy-fun-div</code>, and the relative path to <code>samp.csv</code> is <code>data/samp.csv</code>.</li>
</ul>
<p>We can also use <code>here</code> package to specify the absolute path to the file.</p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-6_18b5de28261ab96f43d01a2b8b7ca898">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/samp.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "/home/mattocci/phy-fun-div/data/samp.csv"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/samp.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>but don’t do this:</p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-7_7ae64fd79c7a43577604fbe285a4073b">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"/home/mattocci/phy-fun-div/data/samp.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>because absolute paths will be different on different computers (lack of reproducibility). It is also uncomfortable to make file system structure public (security risk).</p>
<p>Now let’s look at the community data.</p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-8_51320767c2a035f12807f80927910521">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 40 × 3
   Site  Species                abund
   &lt;chr&gt; &lt;chr&gt;                  &lt;dbl&gt;
 1 Site1 Illicium_macranthum        1
 2 Site1 Manglietia_insignis        0
 3 Site1 Michelia_floribunda        0
 4 Site1 Beilschmiedia_robusta      0
 5 Site1 Neolitsea_chuii            0
 6 Site1 Lindera_thomsonii          0
 7 Site1 Actinodaphne_forrestii     0
 8 Site1 Machilus_yunnanensis       0
 9 Site2 Illicium_macranthum        1
10 Site2 Manglietia_insignis        2
# ℹ 30 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-9613b2845dd1eaba837d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9613b2845dd1eaba837d">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40"],["Site1","Site1","Site1","Site1","Site1","Site1","Site1","Site1","Site2","Site2","Site2","Site2","Site2","Site2","Site2","Site2","Site3","Site3","Site3","Site3","Site3","Site3","Site3","Site3","Site4","Site4","Site4","Site4","Site4","Site4","Site4","Site4","Site5","Site5","Site5","Site5","Site5","Site5","Site5","Site5"],["Illicium_macranthum","Manglietia_insignis","Michelia_floribunda","Beilschmiedia_robusta","Neolitsea_chuii","Lindera_thomsonii","Actinodaphne_forrestii","Machilus_yunnanensis","Illicium_macranthum","Manglietia_insignis","Michelia_floribunda","Beilschmiedia_robusta","Neolitsea_chuii","Lindera_thomsonii","Actinodaphne_forrestii","Machilus_yunnanensis","Illicium_macranthum","Manglietia_insignis","Michelia_floribunda","Beilschmiedia_robusta","Neolitsea_chuii","Lindera_thomsonii","Actinodaphne_forrestii","Machilus_yunnanensis","Illicium_macranthum","Manglietia_insignis","Michelia_floribunda","Beilschmiedia_robusta","Neolitsea_chuii","Lindera_thomsonii","Actinodaphne_forrestii","Machilus_yunnanensis","Illicium_macranthum","Manglietia_insignis","Michelia_floribunda","Beilschmiedia_robusta","Neolitsea_chuii","Lindera_thomsonii","Actinodaphne_forrestii","Machilus_yunnanensis"],[1,0,0,0,0,0,0,0,1,2,2,2,0,0,0,0,1,0,0,0,0,2,2,2,1,1,0,0,0,2,2,0,1,0,0,0,1,1,0,0]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Site<\/th>\n      <th>Species<\/th>\n      <th>abund<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":3},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Then, we want to make a species <span class="math inline">\(\times\)</span> site matrix. <code>tapply</code> is a useful function here.</p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-9_8ad9a6f66633fb60d06f9660e8f9689b">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(d<span class="sc">$</span>abund, d<span class="sc">$</span>Species, sum)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Actinodaphne_forrestii  Beilschmiedia_robusta    Illicium_macranthum 
                     4                      2                      5 
     Lindera_thomsonii   Machilus_yunnanensis    Manglietia_insignis 
                     5                      2                      3 
   Michelia_floribunda        Neolitsea_chuii 
                     2                      1 </code></pre>
</div>
</div>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-10_f06b3503458dc804d8d689167f6499eb">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>samp <span class="ot">&lt;-</span> <span class="fu">tapply</span>(d<span class="sc">$</span>abund, <span class="fu">list</span>(d<span class="sc">$</span>Site, d<span class="sc">$</span>Species), sum)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Actinodaphne_forrestii Beilschmiedia_robusta Illicium_macranthum
Site1                      0                     0                   1
Site2                      0                     2                   1
Site3                      2                     0                   1
Site4                      2                     0                   1
Site5                      0                     0                   1
      Lindera_thomsonii Machilus_yunnanensis Manglietia_insignis
Site1                 0                    0                   0
Site2                 0                    0                   2
Site3                 2                    2                   0
Site4                 2                    0                   1
Site5                 1                    0                   0
      Michelia_floribunda Neolitsea_chuii
Site1                   0               0
Site2                   2               0
Site3                   0               0
Site4                   0               0
Site5                   0               1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(samp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "matrix" "array" </code></pre>
</div>
</div>
</section>
<section id="phylogeny" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="phylogeny"><span class="header-section-number">3.2</span> Phylogeny</h2>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-11_b1d76a55dbf9678f0e3314d0930d86fa">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>phylo <span class="ot">&lt;-</span> <span class="fu">read.tree</span>(<span class="st">"data/dummy_tree.newick"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(phylo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="diversity_example_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="traits" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="traits"><span class="header-section-number">3.3</span> Traits</h2>
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 59%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th>Abbreviation</th>
<th>Trait</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>LMA</td>
<td>Leaf mass per area</td>
<td>g m<sup>-2</sup></td>
</tr>
<tr class="even">
<td>LL</td>
<td>Leaf lifespans (longevity)</td>
<td>months</td>
</tr>
<tr class="odd">
<td>Amass</td>
<td>Maximum photosynthetic rates per unit mass</td>
<td>nnoml g<sup>-1</sup> s<sup>-</sup>1</td>
</tr>
<tr class="even">
<td>Rmass</td>
<td>Dark respiration rates per unit mass</td>
<td>nnoml g<sup>-1</sup> s<sup>-</sup>1</td>
</tr>
<tr class="odd">
<td>Nmass</td>
<td>Leaf nitrogen per unit mass</td>
<td>%</td>
</tr>
<tr class="even">
<td>Pmass</td>
<td>Leaf phosphorus per unit mass</td>
<td>%</td>
</tr>
<tr class="odd">
<td>WD</td>
<td>Wood density</td>
<td>g cm<sup>-3</sup></td>
</tr>
<tr class="even">
<td>SM</td>
<td>Seed dry mass</td>
<td>mg</td>
</tr>
</tbody>
</table>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-12_a10c00b7ecf151ca7e28cfdb90329933">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>trait <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/dummy_trait.csv"</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(trait)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-a42fc0d88ff462982c88" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-a42fc0d88ff462982c88">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77"],["Acer_campbellii","Actinodaphne_forrestii","Alnus_nepalensis","Anneslea_fragrans","Beilschmiedia_robusta","Betula_alnoides","Camellia_assamica","Camellia_forrestii","Camellia_Pitardii","Camellia_yunnanensis","Castanopsis_echidnocarpa","Castanopsis_wattii","Claoxylon_khasianum","Craibiodendron_yunnanense","Cyclobalanopsis_stewardiana","Eriobotrya_bengalensis","Eriobotrya_tengyuehensis","Eurya_paratetragonoclada","Eurya_quinquelocularis","Eurya_trichocarpa","Exbucklandia_populnea","Ficus_henryi","Ficus_heteromorpha","Ficus_racemosa","Glochidion_a","Ilex_corallina","Ilex_manneiensis","Illicium_macranthum","Itoa_orientalis","Laurocerasus_undulata","Leucosceptrum_canum","Lindera_caudata","Lindera_thomsonii","Lithocarpus_confinis","Lithocarpus_crassifolius","Lithocarpus_dealbatus","Lithocarpus_hancei","Lithocarpus_henryi","Lithocarpus_truncatus","Lithocarpus_xylocarpus","Litsea_a","Litsea_chunii","Litsea_elongata","Machilus_gamblei","Machilus_salicina","Machilus_yunnanensis","Mahonia_duclouxiana","Manglietia_insignis","Melia_toosendan","Meliosma_arnottiana","Meliosma_kirkii","Michelia_floribunda","Myrsine_semiserrata","Neolitsea_chuii","Neolitsea_polycarpa","Olea_rosea","Osbeckia_mepalensis","Padus_napaulensis","Rhododendron_decorum","Rhododendron_irroratum","Rhododendron_leptothrium","Rhus_sylvestris","Saurauia_napaulensis","Schefflera_fengii","Schefflera_shweliensis","Schima_argentea","Schima_noronhae","Skimmia_arborescens","Sterculia_nobilis","Stewartia_pteropetiolata","Stewartia_yunnanensis","Symplocos_anomala","Symplocos_grandis","Symplocos_ramosissima","Symplocos_sumuntia","Ternstroemia_gymnanthera","Vaccinium_duclouxii"],[39.81,69.18000000000001,114.82,66.06999999999999,37.15,114.82,100,51.29,109.65,141.25,66.06999999999999,89.13,69.18000000000001,316.23,158.49,158.49,128.82,93.33,74.13,56.23,58.88,177.83,602.5599999999999,107.15,50.12,33.88,46.77,288.4,38.9,177.83,48.98,83.18000000000001,87.09999999999999,102.33,165.96,162.18,281.84,194.98,208.93,102.33,52.48,45.71,61.66,91.2,53.7,70.79000000000001,114.82,501.19,102.33,109.65,117.49,138.04,134.9,104.71,70.79000000000001,85.11,186.21,354.81,446.68,416.87,281.84,47.86,309.03,17.38,22.91,131.83,93.33,40.74,43.65,97.72,213.8,58.88,74.13,48.98,77.62,87.09999999999999,251.19],[7.08,12.52,55.17,26.93,21.88,33.07,24.51,11.34,50.34,131.73,13.49,47.13,21.39,72.98,71.45,32.31,73.88,81.84999999999999,24.52,20.35,27.2,148.11,250.94,22.07,12.4,11.39,16.15,115.18,14.4,96.8,11.56,40.3,40.32,22.98,108.44,73.87,104.3,68.95999999999999,103.23,69.58,13.09,24.45,70.05,41.89,21.35,28.92,48.12,187.96,35.39,17.59,61.07,54.17,48.89,65.31,28.34,33.53,86.53,124.41,184.22,267.95,109.86,22.01,146.83,5.38,13.66,83.97,89.84,11.28,12.54,21.33,100.82,37.55,34.07,26.3,47.86,39.94,106.89],[985.05,149.36,76.81,174.55,305.65,85.97,97.93000000000001,301.56,130.34,89.31999999999999,89.25,156.76,88.87,27.86,40.24,33.32,96.06,91.38,103.75,183.25,293.43,83.33,11.35,101.55,470.59,180.52,313.61,26.44,183.31,45.55,315.8,91.59999999999999,241.4,68.8,51.58,36.67,18.74,20.31,23.23,77.47,77.3,135.64,136.92,99.27,153.06,104.55,257.52,22.27,156.16,101,54.83,38.44,166.41,181.2,130.14,82.8,99.93000000000001,24.94,24.06,23.21,56.42,137.68,18.89,475.01,258.88,86.72,66.23999999999999,455.29,264.45,123.21,27.89,238.62,56.15,265.32,57.25,139.45,31.84],[54.71,8.789999999999999,7.56,40.59,34.01,16.4,14.38,17.71,6.03,8.24,18.94,23.44,23.18,2.03,6.19,3.84,8.15,23.8,4.58,42.1,18.3,13.94,3.79,4.87,49.34,66.95,24.62,2.21,11.77,8.25,29.82,20.12,20.45,21.3,11.41,12.12,4.69,12.9,4.65,21.3,5.47,57.32,13.78,14.91,25.22,14.7,16.19,1.29,3.48,9.4,11.48,7.36,4.96,9.93,19.04,16.65,17.46,9.25,2.18,4.68,3.73,25.01,9.57,67.58,55.8,7.18,15.65,29.7,35.62,9.140000000000001,7.23,26.62,29.94,27.88,27.87,9.199999999999999,7.22],[6.56,1.51,1.65,4.32,5.78,2.33,2.27,1.4,2.22,0.74,1.1,2.35,4.56,0.61,0.47,3.43,1.27,0.84,1.19,5.96,2.94,2.38,0.33,1.4,1.86,5.19,5.78,0.75,5.77,1.77,5.71,1.04,1.87,0.98,1.11,3.89,0.44,1.28,0.79,0.85,4.26,4.28,1.53,3.98,5.94,1.27,1.1,0.65,0.95,1.36,2.37,1.58,0.63,1.63,4.23,2.85,0.34,0.32,0.38,0.3,0.37,4.88,0.32,22.69,14.16,0.62,1.28,5.14,3,1.08,0.96,4.22,1.5,5.69,0.97,6.43,1.31],[0.42,0.16,0.1,0.13,0.26,0.09,0.4,0.14,0.07000000000000001,0.05,0.15,0.26,0.22,0.03,0.01,0.08,0.04,0.06,0.11,0.14,0.13,0.06,0.02,0.09,0.13,0.74,0.18,0.03,0.15,0.13,0.31,0.05,0.05,0.11,0.07000000000000001,0.1,0.03,0.02,0.06,0.05,0.13,0.42,0.21,0.16,0.16,0.44,0.11,0.02,0.18,0.13,0.05,0.02,0.03,0.12,0.24,0.05,0.08,0.06,0.01,0.14,0.08,0.16,0.03,0.48,0.52,0.06,0.09,0.23,0.46,0.16,0.08,0.42,0.09,0.19,0.05,0.08,0.03],[0.46,0.48,0.35,0.54,0.47,0.45,0.42,0.49,0.43,0.53,0.76,0.41,0.53,0.44,0.33,0.48,0.39,0.63,0.31,0.58,0.53,0.34,0.44,0.58,0.64,0.65,0.49,0.4,0.35,0.58,0.51,0.51,0.53,0.46,0.53,0.6899999999999999,0.42,0.53,0.35,0.49,0.66,0.68,0.41,0.48,0.86,0.59,0.51,0.45,0.43,0.48,0.6,0.54,0.6,0.43,0.45,0.45,0.55,0.54,0.61,0.62,0.64,0.52,0.38,0.5,0.46,0.53,0.44,0.45,0.47,0.37,0.45,0.42,0.46,0.48,0.59,0.51,0.53],[0.39,1.35,1.21,1.25,2.16,0.17,0.55,2.43,5.3,6.95,4.84,1.3,0.29,2.35,0.45,1.16,3.02,2.04,0.5,0.85,4.52,2.87,2.56,0.98,5.19,1.55,5.19,0.97,4.39,2.01,0.55,3.82,0.48,0.38,1.59,0.49,0.42,4.51,2.79,2.73,0.82,2.18,0.58,4.09,0.13,1.08,0.33,0.95,0.46,1.07,1.55,1.86,0.2,0.18,1.92,2.86,4.74,0.37,1.61,1.07,3.22,7.98,3.07,0.92,0.06,3,1.56,2.05,1.87,0.96,0.74,0.83,5.54,1.55,0.14,0.36,0.42]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>sp<\/th>\n      <th>LMA<\/th>\n      <th>LL<\/th>\n      <th>Amass<\/th>\n      <th>Rmass<\/th>\n      <th>Nmass<\/th>\n      <th>Pmass<\/th>\n      <th>WD<\/th>\n      <th>SM<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7,8,9]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="check-how-traits-look-like-first" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="check-how-traits-look-like-first"><span class="header-section-number">3.4</span> Check how traits look like first</h2>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-13_3287d6dba4cb1229488a1e974bd19cba">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>trait_long <span class="ot">&lt;-</span> trait <span class="sc">|&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(LMA<span class="sc">:</span>SM, <span class="at">names_to =</span> <span class="st">"trait"</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>trait_long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 616 × 3
   sp                     trait  value
   &lt;chr&gt;                  &lt;chr&gt;  &lt;dbl&gt;
 1 Acer_campbellii        LMA    39.8 
 2 Acer_campbellii        LL      7.08
 3 Acer_campbellii        Amass 985.  
 4 Acer_campbellii        Rmass  54.7 
 5 Acer_campbellii        Nmass   6.56
 6 Acer_campbellii        Pmass   0.42
 7 Acer_campbellii        WD      0.46
 8 Acer_campbellii        SM      0.39
 9 Actinodaphne_forrestii LMA    69.2 
10 Actinodaphne_forrestii LL     12.5 
# ℹ 606 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(trait_long, <span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> trait, <span class="at">scale =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="diversity_example_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Probably we can do log-transformation for all the traits except for WD.</p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-14_ebaf6aa56e906048abe773296636f2f9">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>trait2 <span class="ot">&lt;-</span> trait <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">c</span>(LMA, LL, Amass, Rmass, Nmass, Pmass, SM),</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>       <span class="sc">~</span> <span class="fu">log</span>(.),</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">.names =</span> <span class="st">"log_{.col}"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sp, log_LMA, log_LL, log_Amass, log_Rmass, log_Nmass, log_Pmass, WD, log_SM)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>trait2 <span class="sc">|&gt;</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">round</span>(., <span class="dv">2</span>))) <span class="sc">|&gt;</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  DT<span class="sc">::</span><span class="fu">datatable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-9613b2845dd1eaba837d" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-9613b2845dd1eaba837d">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77"],["Acer_campbellii","Actinodaphne_forrestii","Alnus_nepalensis","Anneslea_fragrans","Beilschmiedia_robusta","Betula_alnoides","Camellia_assamica","Camellia_forrestii","Camellia_Pitardii","Camellia_yunnanensis","Castanopsis_echidnocarpa","Castanopsis_wattii","Claoxylon_khasianum","Craibiodendron_yunnanense","Cyclobalanopsis_stewardiana","Eriobotrya_bengalensis","Eriobotrya_tengyuehensis","Eurya_paratetragonoclada","Eurya_quinquelocularis","Eurya_trichocarpa","Exbucklandia_populnea","Ficus_henryi","Ficus_heteromorpha","Ficus_racemosa","Glochidion_a","Ilex_corallina","Ilex_manneiensis","Illicium_macranthum","Itoa_orientalis","Laurocerasus_undulata","Leucosceptrum_canum","Lindera_caudata","Lindera_thomsonii","Lithocarpus_confinis","Lithocarpus_crassifolius","Lithocarpus_dealbatus","Lithocarpus_hancei","Lithocarpus_henryi","Lithocarpus_truncatus","Lithocarpus_xylocarpus","Litsea_a","Litsea_chunii","Litsea_elongata","Machilus_gamblei","Machilus_salicina","Machilus_yunnanensis","Mahonia_duclouxiana","Manglietia_insignis","Melia_toosendan","Meliosma_arnottiana","Meliosma_kirkii","Michelia_floribunda","Myrsine_semiserrata","Neolitsea_chuii","Neolitsea_polycarpa","Olea_rosea","Osbeckia_mepalensis","Padus_napaulensis","Rhododendron_decorum","Rhododendron_irroratum","Rhododendron_leptothrium","Rhus_sylvestris","Saurauia_napaulensis","Schefflera_fengii","Schefflera_shweliensis","Schima_argentea","Schima_noronhae","Skimmia_arborescens","Sterculia_nobilis","Stewartia_pteropetiolata","Stewartia_yunnanensis","Symplocos_anomala","Symplocos_grandis","Symplocos_ramosissima","Symplocos_sumuntia","Ternstroemia_gymnanthera","Vaccinium_duclouxii"],[3.68,4.24,4.74,4.19,3.61,4.74,4.61,3.94,4.7,4.95,4.19,4.49,4.24,5.76,5.07,5.07,4.86,4.54,4.31,4.03,4.08,5.18,6.4,4.67,3.91,3.52,3.85,5.66,3.66,5.18,3.89,4.42,4.47,4.63,5.11,5.09,5.64,5.27,5.34,4.63,3.96,3.82,4.12,4.51,3.98,4.26,4.74,6.22,4.63,4.7,4.77,4.93,4.9,4.65,4.26,4.44,5.23,5.87,6.1,6.03,5.64,3.87,5.73,2.86,3.13,4.88,4.54,3.71,3.78,4.58,5.37,4.08,4.31,3.89,4.35,4.47,5.53],[1.96,2.53,4.01,3.29,3.09,3.5,3.2,2.43,3.92,4.88,2.6,3.85,3.06,4.29,4.27,3.48,4.3,4.4,3.2,3.01,3.3,5,5.53,3.09,2.52,2.43,2.78,4.75,2.67,4.57,2.45,3.7,3.7,3.13,4.69,4.3,4.65,4.23,4.64,4.24,2.57,3.2,4.25,3.74,3.06,3.36,3.87,5.24,3.57,2.87,4.11,3.99,3.89,4.18,3.34,3.51,4.46,4.82,5.22,5.59,4.7,3.09,4.99,1.68,2.61,4.43,4.5,2.42,2.53,3.06,4.61,3.63,3.53,3.27,3.87,3.69,4.67],[6.89,5.01,4.34,5.16,5.72,4.45,4.58,5.71,4.87,4.49,4.49,5.05,4.49,3.33,3.69,3.51,4.56,4.52,4.64,5.21,5.68,4.42,2.43,4.62,6.15,5.2,5.75,3.27,5.21,3.82,5.76,4.52,5.49,4.23,3.94,3.6,2.93,3.01,3.15,4.35,4.35,4.91,4.92,4.6,5.03,4.65,5.55,3.1,5.05,4.62,4,3.65,5.11,5.2,4.87,4.42,4.6,3.22,3.18,3.14,4.03,4.92,2.94,6.16,5.56,4.46,4.19,6.12,5.58,4.81,3.33,5.47,4.03,5.58,4.05,4.94,3.46],[4,2.17,2.02,3.7,3.53,2.8,2.67,2.87,1.8,2.11,2.94,3.15,3.14,0.71,1.82,1.35,2.1,3.17,1.52,3.74,2.91,2.63,1.33,1.58,3.9,4.2,3.2,0.79,2.47,2.11,3.4,3,3.02,3.06,2.43,2.49,1.55,2.56,1.54,3.06,1.7,4.05,2.62,2.7,3.23,2.69,2.78,0.25,1.25,2.24,2.44,2,1.6,2.3,2.95,2.81,2.86,2.22,0.78,1.54,1.32,3.22,2.26,4.21,4.02,1.97,2.75,3.39,3.57,2.21,1.98,3.28,3.4,3.33,3.33,2.22,1.98],[1.88,0.41,0.5,1.46,1.75,0.85,0.82,0.34,0.8,-0.3,0.1,0.85,1.52,-0.49,-0.76,1.23,0.24,-0.17,0.17,1.79,1.08,0.87,-1.11,0.34,0.62,1.65,1.75,-0.29,1.75,0.57,1.74,0.04,0.63,-0.02,0.1,1.36,-0.82,0.25,-0.24,-0.16,1.45,1.45,0.43,1.38,1.78,0.24,0.1,-0.43,-0.05,0.31,0.86,0.46,-0.46,0.49,1.44,1.05,-1.08,-1.14,-0.97,-1.2,-0.99,1.59,-1.14,3.12,2.65,-0.48,0.25,1.64,1.1,0.08,-0.04,1.44,0.41,1.74,-0.03,1.86,0.27],[-0.87,-1.83,-2.3,-2.04,-1.35,-2.41,-0.92,-1.97,-2.66,-3,-1.9,-1.35,-1.51,-3.51,-4.61,-2.53,-3.22,-2.81,-2.21,-1.97,-2.04,-2.81,-3.91,-2.41,-2.04,-0.3,-1.71,-3.51,-1.9,-2.04,-1.17,-3,-3,-2.21,-2.66,-2.3,-3.51,-3.91,-2.81,-3,-2.04,-0.87,-1.56,-1.83,-1.83,-0.82,-2.21,-3.91,-1.71,-2.04,-3,-3.91,-3.51,-2.12,-1.43,-3,-2.53,-2.81,-4.61,-1.97,-2.53,-1.83,-3.51,-0.73,-0.65,-2.81,-2.41,-1.47,-0.78,-1.83,-2.53,-0.87,-2.41,-1.66,-3,-2.53,-3.51],[0.46,0.48,0.35,0.54,0.47,0.45,0.42,0.49,0.43,0.53,0.76,0.41,0.53,0.44,0.33,0.48,0.39,0.63,0.31,0.58,0.53,0.34,0.44,0.58,0.64,0.65,0.49,0.4,0.35,0.58,0.51,0.51,0.53,0.46,0.53,0.6899999999999999,0.42,0.53,0.35,0.49,0.66,0.68,0.41,0.48,0.86,0.59,0.51,0.45,0.43,0.48,0.6,0.54,0.6,0.43,0.45,0.45,0.55,0.54,0.61,0.62,0.64,0.52,0.38,0.5,0.46,0.53,0.44,0.45,0.47,0.37,0.45,0.42,0.46,0.48,0.59,0.51,0.53],[-0.9399999999999999,0.3,0.19,0.22,0.77,-1.77,-0.6,0.89,1.67,1.94,1.58,0.26,-1.24,0.85,-0.8,0.15,1.11,0.71,-0.6899999999999999,-0.16,1.51,1.05,0.9399999999999999,-0.02,1.65,0.44,1.65,-0.03,1.48,0.7,-0.6,1.34,-0.73,-0.97,0.46,-0.71,-0.87,1.51,1.03,1,-0.2,0.78,-0.54,1.41,-2.04,0.08,-1.11,-0.05,-0.78,0.07000000000000001,0.44,0.62,-1.61,-1.71,0.65,1.05,1.56,-0.99,0.48,0.07000000000000001,1.17,2.08,1.12,-0.08,-2.81,1.1,0.44,0.72,0.63,-0.04,-0.3,-0.19,1.71,0.44,-1.97,-1.02,-0.87]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>sp<\/th>\n      <th>log_LMA<\/th>\n      <th>log_LL<\/th>\n      <th>log_Amass<\/th>\n      <th>log_Rmass<\/th>\n      <th>log_Nmass<\/th>\n      <th>log_Pmass<\/th>\n      <th>WD<\/th>\n      <th>log_SM<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7,8,9]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-15_9ee0ea5980cdb607aa04f455849c80fe">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>trait2 <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(log_LMA<span class="sc">:</span>log_SM, <span class="at">names_to =</span> <span class="st">"trait"</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> trait, <span class="at">scale =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="diversity_example_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="first-order-metrics-without-phylogeny-or-traits" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> First-order metrics (without phylogeny or traits)</h1>
<section id="species-richness" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="species-richness"><span class="header-section-number">4.1</span> Species richness</h2>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-16_d9101d56a1910a63e104d31f58018bb3">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>samp <span class="sc">&gt;</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Actinodaphne_forrestii Beilschmiedia_robusta Illicium_macranthum
Site1                  FALSE                 FALSE                TRUE
Site2                  FALSE                  TRUE                TRUE
Site3                   TRUE                 FALSE                TRUE
Site4                   TRUE                 FALSE                TRUE
Site5                  FALSE                 FALSE                TRUE
      Lindera_thomsonii Machilus_yunnanensis Manglietia_insignis
Site1             FALSE                FALSE               FALSE
Site2             FALSE                FALSE                TRUE
Site3              TRUE                 TRUE               FALSE
Site4              TRUE                FALSE                TRUE
Site5              TRUE                FALSE               FALSE
      Michelia_floribunda Neolitsea_chuii
Site1               FALSE           FALSE
Site2                TRUE           FALSE
Site3               FALSE           FALSE
Site4               FALSE           FALSE
Site5               FALSE            TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(samp <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, sum)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Site1 Site2 Site3 Site4 Site5 
    1     4     4     4     3 </code></pre>
</div>
</div>
</section>
<section id="shannon" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="shannon"><span class="header-section-number">4.2</span> Shannon</h2>
<p><span class="math inline">\(H' = - \sum_i^n p_i\mathrm{log}p_i\)</span>, where <span class="math inline">\(p_i\)</span> is the relative abundance for species <em>i</em>.</p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-17_83239f0784f0ceb2b284beddcaada684">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>shannon <span class="ot">&lt;-</span> <span class="cf">function</span>(abund) {</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  p0 <span class="ot">&lt;-</span> abund <span class="sc">/</span> <span class="fu">sum</span>(abund)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> p0[p0 <span class="sc">&gt;</span> <span class="dv">0</span>]</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fu">sum</span>(p <span class="sc">*</span> <span class="fu">log</span>(p))</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-18_48b4984cd411efbda9f03828cb28ec66">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(samp, <span class="dv">1</span>, shannon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Site1    Site2    Site3    Site4    Site5 
0.000000 1.351784 1.351784 1.329661 1.098612 </code></pre>
</div>
</div>
<p>You don’t have to reinvent the wheel.</p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-19_38baee9a661d567ba9b7395a6aae4cac">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>vegan<span class="sc">::</span><span class="fu">diversity</span>(samp, <span class="at">index =</span> <span class="st">"shannon"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Site1    Site2    Site3    Site4    Site5 
0.000000 1.351784 1.351784 1.329661 1.098612 </code></pre>
</div>
</div>
</section>
<section id="nonmetric-multidimensional-scaling-nmds" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="nonmetric-multidimensional-scaling-nmds"><span class="header-section-number">4.3</span> Nonmetric Multidimensional Scaling (NMDS)</h2>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-20_7b3a2c4b7204a3edacadd2572dab09bb">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>res_mds <span class="ot">&lt;-</span> <span class="fu">metaMDS</span>(samp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Run 0 stress 0 
Run 1 stress 7.054053e-05 
... Procrustes: rmse 0.1288635  max resid 0.198604 
Run 2 stress 8.429922e-05 
... Procrustes: rmse 0.1463009  max resid 0.2669394 
Run 3 stress 0 
... Procrustes: rmse 0.1090292  max resid 0.1592438 
Run 4 stress 0 
... Procrustes: rmse 0.05941474  max resid 0.09519876 
Run 5 stress 8.512828e-05 
... Procrustes: rmse 0.1191058  max resid 0.1785049 
Run 6 stress 0.1302441 
Run 7 stress 0 
... Procrustes: rmse 0.07841779  max resid 0.1275925 
Run 8 stress 0 
... Procrustes: rmse 0.07106395  max resid 0.0960611 
Run 9 stress 5.780344e-05 
... Procrustes: rmse 0.02346335  max resid 0.03923686 
Run 10 stress 0 
... Procrustes: rmse 0.09767687  max resid 0.1363813 
Run 11 stress 0.09681018 
Run 12 stress 7.894815e-05 
... Procrustes: rmse 0.06817085  max resid 0.08745644 
Run 13 stress 6.190828e-06 
... Procrustes: rmse 0.09033978  max resid 0.1170717 
Run 14 stress 0.1302441 
Run 15 stress 7.463175e-05 
... Procrustes: rmse 0.1288812  max resid 0.1986409 
Run 16 stress 8.829549e-05 
... Procrustes: rmse 0.1430439  max resid 0.2501089 
Run 17 stress 7.069814e-05 
... Procrustes: rmse 0.128874  max resid 0.1986277 
Run 18 stress 0 
... Procrustes: rmse 0.06497352  max resid 0.1058612 
Run 19 stress 0.09680968 
Run 20 stress 9.488052e-05 
... Procrustes: rmse 0.128858  max resid 0.1986321 
*** Best solution was not repeated -- monoMDS stopping criteria:
    16: stress &lt; smin
     1: stress ratio &gt; sratmax
     3: scale factor of the gradient &lt; sfgrmin</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(res_mds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="diversity_example_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can use the function <code>ordiplot</code> and <code>orditorp</code> to add text to the plot in place of points to make some more sense.</p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-21_884be6f61ff12c483c0b73e5b7248eb8">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ordiplot</span>(res_mds, <span class="at">type =</span> <span class="st">"n"</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">orditorp</span>(res_mds, <span class="at">display =</span> <span class="st">"species"</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">air =</span> <span class="fl">0.01</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">orditorp</span>(res_mds, <span class="at">display =</span> <span class="st">"sites"</span>, <span class="at">cex =</span> <span class="fl">1.25</span>, <span class="at">air =</span> <span class="fl">0.01</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="diversity_example_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="phylogenetic-metrics" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Phylogenetic metrics</h1>
<section id="branch-length-based-metric" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="branch-length-based-metric"><span class="header-section-number">5.1</span> Branch length based metric</h2>
<section id="pd" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="pd"><span class="header-section-number">5.1.1</span> PD</h3>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-22_17c8ddf7ad89896a34c924ed05248f51">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>res_pd <span class="ot">&lt;-</span> <span class="fu">pd</span>(samp, phylo)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>res_pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            PD SR
Site1 1.000000  1
Site2 3.022727  4
Site3 2.909091  4
Site4 3.136364  4
Site5 2.454545  3</code></pre>
</div>
</div>
<p>You can always see the help.</p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-23_9933c970ae91f3c6550faad9f75a875c">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>?pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="distance-based-metric" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="distance-based-metric"><span class="header-section-number">5.2</span> Distance based metric</h2>
<p><code>cophenetic()</code> creates distance matrices based on phylogenetic trees. Let’s see the first 5 species.</p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-24_e19691156d5879526a9c9691396e9ae3">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cophenetic</span>(phylo)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    Acer_campbellii Melia_toosendan Skimmia_arborescens
Acer_campbellii           0.0000000      0.18181818          0.18181818
Melia_toosendan           0.1818182      0.00000000          0.09090909
Skimmia_arborescens       0.1818182      0.09090909          0.00000000
Rhus_sylvestris           0.3636364      0.36363636          0.36363636
Sterculia_nobilis         0.5454545      0.54545455          0.54545455
                    Rhus_sylvestris Sterculia_nobilis
Acer_campbellii           0.3636364         0.5454545
Melia_toosendan           0.3636364         0.5454545
Skimmia_arborescens       0.3636364         0.5454545
Rhus_sylvestris           0.0000000         0.5454545
Sterculia_nobilis         0.5454545         0.0000000</code></pre>
</div>
</div>
<section id="mpd" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="mpd"><span class="header-section-number">5.2.1</span> MPD</h3>
<p><span class="math inline">\(MPD = \frac{1}{n} \Sigma^n_i \Sigma^n_j \delta_{i,j} \; i \neq j\)</span>, where <span class="math inline">\(\delta_{i, j}\)</span> is the pairwise distance between species <em>i</em> and <em>j</em></p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-25_1e50a9cc2877c2dadc83766a02d20bb0">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>res_mpd <span class="ot">&lt;-</span> <span class="fu">mpd</span>(samp, <span class="fu">cophenetic</span>(phylo))</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>res_mpd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]       NA 1.568182 1.454545 1.606061 1.636364</code></pre>
</div>
</div>
<p>The above vector shows MPD for each site.</p>
</section>
<section id="mntd" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="mntd"><span class="header-section-number">5.2.2</span> MNTD</h3>
<p><span class="math inline">\(MNTD = \frac{1}{n} \Sigma^n_i min \delta_{i,j} \; i \neq j\)</span>, where <span class="math inline">\(min \delta_{i, j}\)</span> is the minimum distance between species <em>i</em> and all other species in the community.</p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-26_bc69ddc48d6421b59cf4ccf7e42f8c25">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>res_mntd <span class="ot">&lt;-</span> <span class="fu">mntd</span>(samp, <span class="fu">cophenetic</span>(phylo))</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>res_mntd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]       NA 1.181818 1.181818 1.295455 1.272727</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="functional-metrics" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Functional metrics</h1>
<section id="community-weighted-means-cwm" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="community-weighted-means-cwm"><span class="header-section-number">6.1</span> Community weighted means (CWM)</h2>
<p><span class="math display">\[
\mathrm{CWM}_i = \frac{\sum_{j=1}^n a_{ij} \times t_{j}}{\sum_{j=1}^n a_{ij}}
\]</span></p>
<p>or</p>
<p><span class="math display">\[
\mathrm{CWM}_i = \frac{\vec{a_i} \cdot \vec{t}}{\sum_{j=1}^n a_{ij}},
\]</span></p>
<p>where <span class="math inline">\(a_{ij}\)</span> is the abundance of species <em>j</em> in community <em>i</em>, and <span class="math inline">\(t_{j}\)</span> is a trait value of species <em>j</em>.</p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-27_d403baac97ef622ac3cf573374387ffa">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> trait2 <span class="sc">|&gt;</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sp <span class="sc">%in%</span> <span class="fu">colnames</span>(samp))</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>tmp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 9
  sp        log_LMA log_LL log_Amass log_Rmass log_Nmass log_Pmass    WD  log_SM
  &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
1 Actinoda…    4.24   2.53      5.01     2.17      0.412    -1.83   0.48  0.300 
2 Beilschm…    3.61   3.09      5.72     3.53      1.75     -1.35   0.47  0.770 
3 Illicium…    5.66   4.75      3.27     0.793    -0.288    -3.51   0.4  -0.0305
4 Lindera_…    4.47   3.70      5.49     3.02      0.626    -3.00   0.53 -0.734 
5 Machilus…    4.26   3.36      4.65     2.69      0.239    -0.821  0.59  0.0770
6 Mangliet…    6.22   5.24      3.10     0.255    -0.431    -3.91   0.45 -0.0513
7 Michelia…    4.93   3.99      3.65     2.00      0.457    -3.91   0.54  0.621 
8 Neolitse…    4.65   4.18      5.20     2.30      0.489    -2.12   0.43 -1.71  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>(ab <span class="ot">&lt;-</span> <span class="fu">apply</span>(samp, <span class="dv">1</span>, sum))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Site1 Site2 Site3 Site4 Site5 
    1     7     7     6     3 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># %*% denotes inner product</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>(cws <span class="ot">&lt;-</span> samp <span class="sc">%*%</span> <span class="fu">as.matrix</span>(tmp[, <span class="sc">-</span><span class="dv">1</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        log_LMA    log_LL log_Amass  log_Rmass  log_Nmass  log_Pmass   WD
Site1  5.664348  4.746496  3.274878  0.7929925 -0.2876821  -3.506558 0.40
Site2 35.183333 29.374355 28.224437 12.3477060  3.2744092 -21.848797 3.32
Site3 31.591321 23.923913 33.559838 16.5518827  2.2664479 -14.805146 3.60
Site4 29.288871 22.431075 27.363748 11.4308299  1.3576312 -17.075208 2.87
Site5 14.782600 12.622489 13.960935  6.1065359  0.8268364  -8.622554 1.36
           log_SM
Site1 -0.03045921
Site2  2.64832362
Site3 -0.74426629
Site4 -0.94948167
Site5 -2.47922681</code></pre>
</div>
</div>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-28_0330d836e868d22febd4290be16ab14d">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>(cwm <span class="ot">&lt;-</span> cws <span class="sc">/</span> ab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       log_LMA   log_LL log_Amass log_Rmass  log_Nmass log_Pmass        WD
Site1 5.664348 4.746496  3.274878 0.7929925 -0.2876821 -3.506558 0.4000000
Site2 5.026190 4.196336  4.032062 1.7639580  0.4677727 -3.121257 0.4742857
Site3 4.513046 3.417702  4.794263 2.3645547  0.3237783 -2.115021 0.5142857
Site4 4.881479 3.738513  4.560625 1.9051383  0.2262719 -2.845868 0.4783333
Site5 4.927533 4.207496  4.653645 2.0355120  0.2756121 -2.874185 0.4533333
           log_SM
Site1 -0.03045921
Site2  0.37833195
Site3 -0.10632376
Site4 -0.15824694
Site5 -0.82640894</code></pre>
</div>
</div>
<p>The species <span class="math inline">\(\times\)</span> site matrix and the species <span class="math inline">\(\times\)</span> trait matrix became the trait <span class="math inline">\(\times\)</span> site matrix.</p>
</section>
<section id="distance-based-metrics" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="distance-based-metrics"><span class="header-section-number">6.2</span> Distance based metrics</h2>
<section id="prepare-a-trait-distance-matrix" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="prepare-a-trait-distance-matrix"><span class="header-section-number">6.2.1</span> Prepare a trait distance matrix</h3>
<p>We have a <code>data.fame</code> or <code>tibble</code> object of traits. First, we need to prepare a trait matrix, then a distance matrix based on trait values.</p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-29_fd04d08626d105169b92cbbd490fa74a">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>trait_mat0 <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(trait2[, <span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(trait_mat0) <span class="ot">&lt;-</span> trait2<span class="sc">$</span>sp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s see a subset of the trait matrix</p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-30_3dbd91e152e958469c17d1fc8607a9ef">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>trait_mat0[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        log_LMA   log_LL log_Amass log_Rmass log_Nmass
Acer_campbellii        3.684118 1.957274  6.892692  4.002047 1.8809906
Actinodaphne_forrestii 4.236712 2.527327  5.006359  2.173615 0.4121097
Alnus_nepalensis       4.743366 4.010419  4.341335  2.022871 0.5007753
Anneslea_fragrans      4.190715 3.293241  5.162211  3.703522 1.4632554
Beilschmiedia_robusta  3.614964 3.085573  5.722441  3.526655 1.7544037</code></pre>
</div>
</div>
<p>Then, we will make a trait distance matrix based on the Euclidean distance. There are other distance measures, for example <a href="https://www.rdocumentation.org/packages/gower/versions/0.2.1/topics/gower_dist">Gower’s Distance</a>, but we focus on the Euclidean distance today.</p>
<p>Before calculating distance, we need to make sure the unit change in distances is the same for different traits. We will scale trait values so that they have mean = 0 and SD = 1. (e.g., <span class="math inline">\((X_i - \mu) / \sigma\)</span>)</p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-31_0aeb2af415d2dcdf38a4b3e8f2ce0a4d">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (trait_mat0 - mean(trait_mat0)) / sd(trait_mat0)</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>trait_mat <span class="ot">&lt;-</span> <span class="fu">scale</span>(trait_mat0)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(trait_mat0[, <span class="st">"log_LMA"</span>])</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(trait_mat[, <span class="st">"log_LMA"</span>])</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(trait_mat0[, <span class="st">"WD"</span>])</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(trait_mat[, <span class="st">"WD"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="diversity_example_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can make a trait distance matrix.</p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-32_a39c3681ea2bdcb9a59800a727558f37">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>trait_dm <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">dist</span>(trait_mat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s see the first 5 species.</p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-33_bb33972613a6cab413e58a01197e0e13">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>trait_dm[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                       Acer_campbellii Actinodaphne_forrestii Alnus_nepalensis
Acer_campbellii               0.000000               3.799360         5.216902
Actinodaphne_forrestii        3.799360               0.000000         2.415031
Alnus_nepalensis              5.216902               2.415031         0.000000
Anneslea_fragrans             3.175911               2.335392         3.225141
Beilschmiedia_robusta         2.545269               2.565063         3.638183
                       Anneslea_fragrans Beilschmiedia_robusta
Acer_campbellii                 3.175911              2.545269
Actinodaphne_forrestii          2.335392              2.565063
Alnus_nepalensis                3.225141              3.638183
Anneslea_fragrans               0.000000              1.579930
Beilschmiedia_robusta           1.579930              0.000000</code></pre>
</div>
</div>
</section>
<section id="mpd-mean-pairwise-distance" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="mpd-mean-pairwise-distance"><span class="header-section-number">6.2.2</span> MPD (Mean Pairwise Distance)</h3>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-34_dcb81a1b81479d08c3e25124988815cb">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mpd</span>(samp, trait_dm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]       NA 4.288349 3.530805 3.961248 3.438008</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ses.mpd</span>(samp, trait_dm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      ntaxa  mpd.obs mpd.rand.mean mpd.rand.sd mpd.obs.rank  mpd.obs.z
Site1     1       NA           NaN          NA           NA         NA
Site2     4 4.288349      3.685609   0.7978280          779  0.7554765
Site3     4 3.530805      3.714732   0.8045447          436 -0.2286095
Site4     4 3.961248      3.712215   0.8094178          628  0.3076695
Site5     3 3.438008      3.701289   1.0133848          455 -0.2598035
      mpd.obs.p runs
Site1        NA  999
Site2     0.779  999
Site3     0.436  999
Site4     0.628  999
Site5     0.455  999</code></pre>
</div>
</div>
<p><strong>Effect size (ES)</strong></p>
<p><span class="math display">\[
ES = \frac{\bar{x_1} - \bar{x_2}}{\sigma} \sim Normal(\bar{x_1} - \bar{x_2}, 1)
\]</span></p>
<p>where <span class="math inline">\(\bar{x_1}\)</span> is the mean value of <span class="math inline">\(x_1\)</span>, <span class="math inline">\(\bar{x_2}\)</span> is the mean value of <span class="math inline">\(x_2\)</span>, and <span class="math inline">\(\sigma\)</span> is the standard deviation of the pooled data.</p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-35_ecebf68340ca4c543e6a2edf2bf57551">
<div class="cell-output-display">
<p><img src="diversity_example_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In null model analyses, we can translate this into a standardized effect size (SES):</p>
<p><span class="math display">\[
SES = \frac{obs - \bar{rand}}{\sigma_{rand}}
\]</span></p>
<p>where obs is the observed metric, <span class="math inline">\(\bar{rand}\)</span> is the mean value of the metric in null communities, and <span class="math inline">\(\sigma_{rand}\)</span> is the standard deviation of the metric in the null communities.</p>
</section>
<section id="mntd-mean-nearest-taxon-distance" class="level3" data-number="6.2.3">
<h3 data-number="6.2.3" class="anchored" data-anchor-id="mntd-mean-nearest-taxon-distance"><span class="header-section-number">6.2.3</span> MNTD (Mean Nearest Taxon Distance)</h3>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-36_0e43e13bdd2e7d942a4ca4b25cacdaf4">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mntd</span>(samp, trait_dm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]       NA 2.504352 2.697074 1.873825 2.613585</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ses.mntd</span>(samp, trait_dm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      ntaxa mntd.obs mntd.rand.mean mntd.rand.sd mntd.obs.rank  mntd.obs.z
Site1     1       NA            NaN           NA            NA          NA
Site2     4 2.504352       2.716063    0.5392128           358 -0.39262859
Site3     4 2.697074       2.711362    0.5408904           522 -0.02641508
Site4     4 1.873825       2.700023    0.5286682            43 -1.56279060
Site5     3 2.613585       2.989970    0.7488349           326 -0.50262705
      mntd.obs.p runs
Site1         NA  999
Site2      0.358  999
Site3      0.522  999
Site4      0.043  999
Site5      0.326  999</code></pre>
</div>
</div>
</section>
</section>
<section id="branch-length-based-metric-1" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="branch-length-based-metric-1"><span class="header-section-number">6.3</span> Branch length based metric</h2>
<section id="fd" class="level3" data-number="6.3.1">
<h3 data-number="6.3.1" class="anchored" data-anchor-id="fd"><span class="header-section-number">6.3.1</span> FD</h3>
<p>We will make a functional dendrogram using clustering methods. We use <a href="https://en.wikipedia.org/wiki/UPGMA">UPGMA</a> in this example.</p>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-37_85012c36d7af8492ccb963b06fbe0640">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>t_clust <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(trait_mat), <span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(t_clust)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="diversity_example_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="1440"></p>
</div>
</div>
</section>
<section id="more-functional-diversity-metrics" class="level3" data-number="6.3.2">
<h3 data-number="6.3.2" class="anchored" data-anchor-id="more-functional-diversity-metrics"><span class="header-section-number">6.3.2</span> More functional diversity metrics</h3>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-38_be15a8fd68c83e86af3bce4c9229e009">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>res_fd <span class="ot">&lt;-</span> <span class="fu">dbFD</span>(trait_mat[<span class="fu">colnames</span>(samp), ], samp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>FEVe: Could not be calculated for communities with &lt;3 functionally singular species. 
FDis: Equals 0 in communities with only one functionally singular species. 
FRic: To respect s &gt; t, FRic could not be calculated for communities with &lt;3 functionally singular species. 
FRic: Dimensionality reduction was required. The last 5 PCoA axes (out of 7 in total) were removed. 
FRic: Quality of the reduced-space representation = 0.811349 
FDiv: Could not be calculated for communities with &lt;3 functionally singular species. </code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>res_fd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$nbsp
Site1 Site2 Site3 Site4 Site5 
    1     4     4     4     3 

$sing.sp
Site1 Site2 Site3 Site4 Site5 
    1     4     4     4     3 

$FRic
   Site1    Site2    Site3    Site4    Site5 
      NA 5.453089 2.917904 3.000656 3.553247 

$qual.FRic
[1] 0.811349

$FEve
    Site1     Site2     Site3     Site4     Site5 
       NA 0.7595456 0.6769400 0.7085376 0.7584941 

$FDiv
    Site1     Site2     Site3     Site4     Site5 
       NA 0.7301943 0.7617251 0.9166699 0.8261683 

$FDis
   Site1    Site2    Site3    Site4    Site5 
0.000000 2.710994 1.842262 2.311159 2.042416 

$RaoQ
   Site1    Site2    Site3    Site4    Site5 
0.000000 8.376023 4.005094 5.664467 4.379844 

$CWM
         log_LMA      log_LL   log_Amass  log_Rmass   log_Nmass  log_Pmass
Site1  1.4467783  1.17548950 -1.38976382 -1.9975087 -0.88119735 -1.2775781
Site2  0.5666449  0.55085046 -0.56218769 -0.8908026 -0.09004842 -0.8660119
Site3 -0.1410729 -0.33319385  0.27087040 -0.2062427 -0.24084641  0.2088166
Site4  0.3670613  0.03104745  0.01551229 -0.7298853 -0.34295985 -0.5718506
Site5  0.4305791  0.56352114  0.11718014 -0.5812855 -0.29128834 -0.6020974
              WD     log_SM
Site1 -1.0150179 -0.2191496
Site2 -0.2744691  0.1665816
Site3  0.1242879 -0.2907346
Site4 -0.2341187 -0.3397288
Site5 -0.4833418 -0.9701997</code></pre>
</div>
</div>
<iframe src="appendixA.htm" width="900" height="1200" allowfullscreen="" frameborder="0">
</iframe>
</section>
</section>
</section>
<section id="related" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Related</h1>
<ul>
<li><p>Aiba, M., Katabuchi, M., Takafumi, H., Matsuzaki, S.S., Sasaki, T. and Hiura, T. (2013), Robustness of trait distribution metrics for community assembly studies under the uncertainties of assembly processes. Ecology, 94: 2873-2885. <a href="https://esajournals.onlinelibrary.wiley.com/doi/abs/10.1890/13-0269.1">doi:10.1890/13-0269.1</a></p></li>
<li><p><a href="https://daijiang.name/en/2014/05/04/notes-func-phylo-book-1/">Phylogenetic diversity in R</a></p></li>
<li><p><a href="https://daijiang.name/en/2014/05/11/functional-diversity-in-r/">Functional diversity in R</a></p></li>
<li><p><a href="https://www.kembellab.ca/r-workshop/biodivR/SK_Biodiversity_R.html">Biodiversity analysis in R</a></p></li>
<li><p><a href="http://traits-dgs.nceas.ucsb.edu/workspace/r/r-tutorial-for-measuring-functional-diversity/Measuring%20Functional%20Diversity%20in%20R.pdf/attachment_download/file">Measuring functional diversity in R</a></p></li>
</ul>
</section>
<section id="computing-environment" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Computing Environment</h1>
<div class="cell" data-hash="diversity_example_cache/html/unnamed-chunk-39_edfc79d22edd2d2a0d19cd6756271199">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">session_info</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.3.2 (2023-10-31)
 os       Ubuntu 20.04.6 LTS
 system   x86_64, linux-gnu
 ui       X11
 language (EN)
 collate  en_US.UTF-8
 ctype    en_US.UTF-8
 tz       Asia/Tokyo
 date     2023-11-15
 pandoc   2.5 @ /usr/bin/ (via rmarkdown)

─ Packages ───────────────────────────────────────────────────────────────────
 ! package     * version  date (UTC) lib source
 P abind         1.4-5    2016-07-21 [?] RSPM (R 4.3.0)
 P ade4        * 1.7-22   2023-02-06 [?] CRAN (R 4.3.2)
 P ape         * 5.7-1    2023-03-13 [?] CRAN (R 4.3.0)
 P BiocManager   1.30.22  2023-08-08 [?] CRAN (R 4.3.2)
 P cachem        1.0.8    2023-05-01 [?] RSPM (R 4.3.0)
 P callr         3.7.3    2022-11-02 [?] RSPM (R 4.3.0)
 P cli           3.6.1    2023-03-23 [?] RSPM (R 4.3.0)
 P cluster       2.1.4    2022-08-22 [?] CRAN (R 4.2.1)
 P codetools     0.2-19   2023-02-01 [?] CRAN (R 4.2.2)
 P colorspace    2.1-0    2023-01-23 [?] RSPM (R 4.3.0)
 P crayon        1.5.2    2022-09-29 [?] RSPM (R 4.3.0)
 P devtools      2.4.5    2022-10-11 [?] RSPM (R 4.3.0)
 P digest        0.6.33   2023-07-07 [?] RSPM (R 4.3.0)
 P dplyr       * 1.1.3    2023-09-03 [?] RSPM (R 4.3.0)
 P ellipsis      0.3.2    2021-04-29 [?] RSPM (R 4.3.0)
 P evaluate      0.23     2023-11-01 [?] RSPM (R 4.3.0)
 P fansi         1.0.5    2023-10-08 [?] RSPM (R 4.3.0)
 P fastmap       1.1.1    2023-02-24 [?] RSPM (R 4.3.0)
 P FD          * 1.0-12.1 2022-05-02 [?] CRAN (R 4.3.2)
 P fontawesome   0.5.2    2023-08-19 [?] RSPM (R 4.3.0)
 P forcats     * 1.0.0    2023-01-29 [?] RSPM (R 4.3.0)
 P fs            1.6.3    2023-07-20 [?] RSPM (R 4.3.0)
 P generics      0.1.3    2022-07-05 [?] RSPM (R 4.3.0)
 P geometry    * 0.4.7    2023-02-03 [?] CRAN (R 4.3.2)
 P ggplot2     * 3.4.4    2023-10-12 [?] RSPM (R 4.3.0)
 P glue          1.6.2    2022-02-24 [?] RSPM (R 4.3.0)
 P gtable        0.3.4    2023-08-21 [?] RSPM (R 4.3.0)
 P hms           1.1.3    2023-03-21 [?] RSPM (R 4.3.0)
 P htmltools     0.5.7    2023-11-03 [?] CRAN (R 4.3.2)
 P htmlwidgets   1.6.2    2023-03-17 [?] RSPM (R 4.3.0)
 P httpuv        1.6.12   2023-10-23 [?] RSPM (R 4.3.1)
 P jsonlite      1.8.7    2023-06-29 [?] RSPM (R 4.3.0)
 P knitr         1.45     2023-10-30 [?] RSPM (R 4.3.0)
 P later         1.3.1    2023-05-02 [?] RSPM (R 4.3.0)
 P lattice     * 0.22-5   2023-10-24 [?] CRAN (R 4.3.1)
 P lifecycle     1.0.4    2023-11-07 [?] CRAN (R 4.3.2)
 P lubridate   * 1.9.3    2023-09-27 [?] RSPM (R 4.3.0)
 P magic         1.6-1    2022-11-16 [?] CRAN (R 4.3.2)
 P magrittr      2.0.3    2022-03-30 [?] RSPM (R 4.3.0)
 P MASS          7.3-60   2023-05-04 [?] CRAN (R 4.3.1)
 P Matrix        1.6-2    2023-11-08 [?] CRAN (R 4.3.2)
 P memoise       2.0.1    2021-11-26 [?] RSPM (R 4.3.0)
 P mgcv          1.9-0    2023-07-11 [?] CRAN (R 4.3.1)
 P mime          0.12     2021-09-28 [?] RSPM (R 4.3.0)
 P miniUI        0.1.1.1  2018-05-18 [?] RSPM (R 4.3.0)
 P munsell       0.5.0    2018-06-12 [?] RSPM (R 4.3.0)
 P nlme        * 3.1-163  2023-08-09 [?] CRAN (R 4.3.1)
 P permute     * 0.9-7    2022-01-27 [?] CRAN (R 4.3.0)
 P picante     * 1.8.2    2020-06-10 [?] CRAN (R 4.3.2)
 P pillar        1.9.0    2023-03-22 [?] RSPM (R 4.3.0)
 P pkgbuild      1.4.2    2023-06-26 [?] RSPM (R 4.3.0)
 P pkgconfig     2.0.3    2019-09-22 [?] RSPM (R 4.3.0)
 P pkgload       1.3.3    2023-09-22 [?] RSPM (R 4.3.1)
 P prettyunits   1.2.0    2023-09-24 [?] RSPM (R 4.3.0)
 P processx      3.8.2    2023-06-30 [?] CRAN (R 4.3.0)
 P profvis       0.3.8    2023-05-02 [?] RSPM (R 4.3.0)
 P promises      1.2.1    2023-08-10 [?] RSPM (R 4.3.0)
 P ps            1.7.5    2023-04-18 [?] RSPM (R 4.3.0)
 P purrr       * 1.0.2    2023-08-10 [?] RSPM (R 4.3.0)
 P R6            2.5.1    2021-08-19 [?] RSPM (R 4.3.0)
 P Rcpp          1.0.11   2023-07-06 [?] RSPM (R 4.3.1)
 P readr       * 2.1.4    2023-02-10 [?] RSPM (R 4.3.0)
 P remotes       2.4.2.1  2023-07-18 [?] RSPM (R 4.3.0)
   renv          1.0.3    2023-09-19 [1] CRAN (R 4.3.2)
 P rlang         1.1.2    2023-11-04 [?] CRAN (R 4.3.2)
 P rmarkdown     2.25     2023-09-18 [?] RSPM (R 4.3.0)
 P scales        1.2.1    2022-08-20 [?] RSPM (R 4.3.0)
 P sessioninfo   1.2.2    2021-12-06 [?] RSPM (R 4.3.0)
 P shiny         1.7.5.1  2023-10-14 [?] RSPM (R 4.3.1)
 P stringi       1.8.1    2023-11-13 [?] CRAN (R 4.3.2)
 P stringr     * 1.5.0    2022-12-02 [?] RSPM (R 4.3.0)
 P tibble      * 3.2.1    2023-03-20 [?] RSPM (R 4.3.0)
 P tidyr       * 1.3.0    2023-01-24 [?] RSPM (R 4.3.0)
 P tidyselect    1.2.0    2022-10-10 [?] RSPM (R 4.3.0)
 P tidyverse   * 2.0.0    2023-02-22 [?] RSPM (R 4.3.0)
 P timechange    0.2.0    2023-01-11 [?] RSPM (R 4.3.0)
 P tzdb          0.4.0    2023-05-12 [?] RSPM (R 4.3.0)
 P urlchecker    1.0.1    2021-11-30 [?] RSPM (R 4.3.0)
 P usethis       2.2.2    2023-07-06 [?] RSPM (R 4.3.0)
 P utf8          1.2.4    2023-10-22 [?] RSPM (R 4.3.1)
 P vctrs         0.6.4    2023-10-12 [?] RSPM (R 4.3.0)
 P vegan       * 2.6-4    2022-10-11 [?] CRAN (R 4.3.0)
 P withr         2.5.2    2023-10-30 [?] RSPM (R 4.3.0)
 P xfun          0.41     2023-11-01 [?] RSPM (R 4.3.0)
 P xtable        1.8-4    2019-04-21 [?] RSPM (R 4.3.0)
 P yaml          2.3.7    2023-01-23 [?] RSPM (R 4.3.0)

 [1] /home/mattocci/phy-fun-div/renv/library/linux-ubuntu-focal/R-4.3/x86_64-pc-linux-gnu
 [2] /home/mattocci/.cache/R/renv/sandbox/linux-ubuntu-focal/R-4.3/x86_64-pc-linux-gnu/9a444a72

 P ── Loaded and on-disk path mismatch.

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      try { hash = new URL(url).hash; } catch {}
      const id = hash.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note !== null) {
        try {
          const html = processXRef(id, note);
          instance.setContent(html);
        } finally {
          instance.enable();
          instance.show();
        }
      } else {
        // See if we can fetch this
        fetch(url.split('#')[0])
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.getElementById(id);
          if (note !== null) {
            const html = processXRef(id, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="diversity_example_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>